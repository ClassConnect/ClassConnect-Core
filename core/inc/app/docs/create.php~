<?php
require_once('core/inc/func/app/docs/main.php');

if (isset($_POST['name'])) {

	if (auth_dir($_POST['target_fid'], $user_id) != true) {
		$attempt[] = 'Unable to verify location.';
	} else {
		$attempt = create_doc($_POST['name'], '', $_POST['target_fid'], $user_id);
	}
	
	if (is_numeric($attempt)) {
		echo $attempt;
	} else {
		echo '<div class="errorbox"><span style="font-size:14px; font-weight:bolder">Oops!</span>';
		foreach ($attempt as $error) {
			echo '<li>' . $error . '</li>';
		}
		echo '</div>';
	}
	
	exit();
}





// show folders
// get current folder id
if ($_GET['id'] != 0) {
	$curDir = escape($_GET['id']);
} else {
	$curDir = 0;
}

if (auth_dir($curDir, $user_id) == true) {

if ($_GET['q'] == 1) {
	$dirList = read_dirFolders($curDir, $user_id);

echo '<script>
$(function() {
		$( "#listFolders" ).buttonset();
	});	
</script>';

echo '<div id="listFolders">';
if ($curDir != 0) {
	$current_folder = get_dir($curDir);
	echo '<li class="hudFileList" style="width:350px; border-bottom:2px solid #999; background-color:#e1e1e1" onDblClick="swapDir(' . $current_folder['parent_id'] . ');">&nbsp;<img src="' . $imgServer . 'gen/arrow_up.png" />&nbsp;&nbsp;<span style="font-size:14px">Parent Folder</li>';
}
// echo the contents of this directory
foreach ($dirList as $entry) {
	echo '<li class="hudFileList" style="width:350px" onDblClick="swapDir(' . $entry['id'] . ');"><input type="radio" id="rad' . $entry['id'] . '" name="target_fid" value="' . $entry['id'] . '" /><label for="rad' . $entry['id'] . '" class="noRound">âœ“</label><span style="padding-left:10px"><img src="' . $imgServer . 'fileBox/folder.png" /> ' . $entry['name'] . '</span></li>';
	
}
if (empty($dirList)) {
	echo '<li class="hudFileList" style="width:350px;padding:5px">No folders found in the directory.</li>';
}
echo '</div>';

exit();	
}
/// if just looking for files
}

?>

<script>
function IsNumeric(sText)

{
   var ValidChars = "0123456789.";
   var IsNumber=true;
   var Char;

 
   for (i = 0; i < sText.length && IsNumber == true; i++) 
      { 
      Char = sText.charAt(i); 
      if (ValidChars.indexOf(Char) == -1) 
         {
         IsNumber = false;
         }
      }
   return IsNumber;
   
   }


function createDoc() {
        dataString = $("#add-doc").serialize();
        var fid = 0;
        $.ajax({
        type: "POST",
        url: "writer.cc?n=1",
        data: dataString,
        success: function(data) {
        	if (IsNumeric(data)) {
               window.location = "writer.cc?n=2&doc_id=" + data;
         } else {
         	 $("#failer").html(data).slideDown(400);
         	 
         }
               
       }

        });
}




function swapDir(dirID, start) {
	$.ajax({
   type: "GET",
   url: "writer.cc?n=1&q=1&id=" + dirID,
   success: function(msg){
   	if (start == 1) {
   		// start toggle
   	}
     $("#contents").html(msg);
   }
 });
}

	$(function() {
		swapDir(0, 1);
	});
	
	
function disableSelection(target){
if (typeof target.onselectstart!="undefined") //IE route
	target.onselectstart=function(){return false}
else if (typeof target.style.MozUserSelect!="undefined") //Firefox route
	target.style.MozUserSelect="none"
else //All other route (ie: Opera)
	target.onmousedown=function(){return false}
target.style.cursor = "default"
}


disableSelection(document.getElementById("contents"));
</script>
<?php

	echo '<div class="headTitle"><img src="' . $imgServer . 'gen/addDoc.png" style="margin-top:3px; margin-right: 3px" /><div>Create Document</div></div>
<div id="failer" style="display:none"></div>
<form method="POST" id="add-doc" style="font-size:14px">	
<div style="margin:5px">
<strong>Document Name </strong> <span style="color:#dd1100;font-style: bolder">*</span><br />
<input type="text" name="name" style="width:300px" maxlength="45" />

<br /><br /><strong>File Location </strong> <span style="color:#dd1100;font-style: bolder">*</span> 
</div>
<div id="contents" style="border-top:1px solid #999; margin-top:10px">



</div>
<input type="password" size="1" style="display:none" />
</form>


<div id="bottom" style="margin-top:10px; margin-bottom:5px; float:right">
<button class="button" onClick="createDoc();" type="submit"> 
<img src="' . $imgServer . 'gen/tick.png" /> Create Document
</button>
<button class="button" onClick="closeBox();" type="submit"> 
<img src="' . $imgServer . 'gen/cross.png" /> Close
</button>
</div>';


?>