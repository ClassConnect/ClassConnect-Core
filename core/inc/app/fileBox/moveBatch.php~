<?php
if (isset($_GET['target_fid'])) {

// clean dir ids
$_GET['ids'] = escape($_GET['ids']);

// clean content ids
$_GET['cids'] = escape($_GET['cids']);
	

move_dir($_GET['ids'], $_GET['target_fid'], $user_id);

move_content($_GET['cids'], $_GET['target_fid'], $user_id);

echo '1';

exit();
} // if move request here















// get current folder id
if ($_GET['id'] != 0) {
	$curDir = escape($_GET['id']);
} else {
	$curDir = 0;
}

if (auth_dir($curDir, $user_id) == true) {

if ($_GET['q'] == 1) {
	$dirList = read_dirFolders($curDir, $user_id);

echo '<script>
$(function() {
		$( "#listFolders" ).buttonset();
	});	
</script>';

echo '<div id="listFolders">';
if ($curDir != 0) {
	$current_folder = get_dir($curDir);
	echo '<li class="hudFileList" style="width:350px; border-bottom:2px solid #999; background-color:#e1e1e1" onDblClick="swapDir(' . $current_folder['parent_id'] . ');">&nbsp;<img src="' . $imgServer . 'gen/arrow_up.png" />&nbsp;&nbsp;<span style="font-size:14px">Parent Folder</li>';
}
// echo the contents of this directory
foreach ($dirList as $entry) {
	echo '<li class="hudFileList" style="width:350px" onDblClick="swapDir(' . $entry['id'] . ');"><input type="radio" id="rad' . $entry['id'] . '" name="target_fid" value="' . $entry['id'] . '" /><label for="rad' . $entry['id'] . '" class="noRound">âœ“</label><span style="padding-left:10px"><img src="' . $imgServer . 'fileBox/folder.png" /> ' . $entry['name'] . '</span></li>';
	
}
if (empty($dirList)) {
	echo '<li class="hudFileList" style="width:350px;padding:5px">No folders found in the directory.</li>';
}
echo '</div>';
	
exit();	
}
/// if just looking for files

echo '<script>
var origFolder = getCurrentFolder();
function resetFolder() {
	parent.location.hash = origFolder;
}

function swapDir(dirID, start) {
	$.ajax({
   type: "GET",
   url: "filebox.cc?n=11&q=1&id=" + dirID,
   success: function(msg){
   	if (start == 1) {
   		msg = \'<div style="padding:5px; font-size:14px; border-bottom:1px solid #999;">Please select a folder below to move your content to. Double click on a folder to view its subfolders.</div>\' + msg;
   	}
     $("#contents").html(msg);
   }
 });
}

	$(function() {
		swapDir(0, 1);
	});
	
	
function disableSelection(target){
if (typeof target.onselectstart!="undefined") //IE route
	target.onselectstart=function(){return false}
else if (typeof target.style.MozUserSelect!="undefined") //Firefox route
	target.style.MozUserSelect="none"
else //All other route (ie: Opera)
	target.onmousedown=function(){return false}
target.style.cursor = "default"
}


disableSelection(document.getElementById("contents"));





function submitMove() {
 dataString = $("#move-content").serialize();
var totalStr = \'\';
				for(var i=0; i<activeFolders.length; i++) {
        			totalStr += activeFolders[i] + \',\';
    			}
    			var totalCon = \'\';
				for(var i=0; i<activeFiles.length; i++) {
        			totalCon += activeFiles[i] + \',\';
    			}
 $.ajax({
   type: "GET",
   url: "filebox.cc?n=11&ids=" + totalStr + "&cids=" + totalCon,
   data: dataString,
   success: function(msg){

   }
 });	

}

	</script>';

echo '<div class="headTitle"><img src="' . $imgServer . 'gen/move_l.png" style="margin-top:3px; margin-right: 5px" /><div>Move Content</div></div>
<form method="GET" id="move-content">
<div id="contents">



</div>
</form>
<div id="bottom" style="margin-top:10px; margin-bottom:5px; float:right">
<button class="button" onClick="submitMove();" onMouseUp="resetFolder();" type="submit"> 
<img src="' . $imgServer . 'gen/tick.png" /> Move To Selected Folder
</button>
<button class="button" onClick="closeBox();" onMouseUp="resetFolder();" type="submit"> 
<img src="' . $imgServer . 'gen/cross.png" /> Close
</button>
</div>';	
} // auth Dir




?>