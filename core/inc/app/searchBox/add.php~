<?php
if (isset($_POST['name'])) {
	$name = escape($_POST['name']);
	$type = escape($_POST['type']);
	$code = escape($_POST['code']);
	$body = escape($_POST['body']);
	$target_id = escape($_POST['target_fid']);
	
	if ($type == 1) {
		$newType = 2;
	} elseif($type == 3) {
		$newType = 3;
	} elseif($type == 4) {
	 	$newType = 5;
	 }
	
	$attempt = create_content($target_id, $user_id, $newType, $name, $body, $code, '', '', '');

	if ($attempt == 1) {
		echo '1';
	} else {
		echo '<div class="errorbox"><span style="font-size:14px; font-weight:bolder">Oops!</span>';
		foreach ($attempt as $error) {
			echo '<li>' . $error . '</li>';
		}
		echo '</div>';
	}
	



	exit();
}
// if add request















// get current folder id
if ($_GET['id'] != 0) {
	$curDir = escape($_GET['id']);
} else {
	$curDir = 0;
}

if (auth_dir($curDir, $user_id) == true) {

if ($_GET['q'] == 1) {
	$dirList = read_dirFolders($curDir, $user_id);

echo '<script>
$(function() {
		$( "#listFolders" ).buttonset();
	});	
</script>';

echo '<div id="listFolders">';
if ($curDir != 0) {
	$current_folder = get_dir($curDir);
	echo '<li class="hudFileList" style="width:350px; border-bottom:2px solid #999; background-color:#e1e1e1" onDblClick="swapDir(' . $current_folder['parent_id'] . ');">&nbsp;<img src="' . $imgServer . 'gen/arrow_up.png" />&nbsp;&nbsp;<span style="font-size:14px">Parent Folder</li>';
}
// echo the contents of this directory
foreach ($dirList as $entry) {
	echo '<li class="hudFileList" style="width:350px" onDblClick="swapDir(' . $entry['id'] . ');"><input type="radio" id="rad' . $entry['id'] . '" name="target_fid" value="' . $entry['id'] . '" /><label for="rad' . $entry['id'] . '" class="noRound">âœ“</label><span style="padding-left:10px"><img src="' . $imgServer . 'fileBox/folder.png" /> ' . $entry['name'] . '</span></li>';
	
}
if (empty($dirList)) {
	echo '<li class="hudFileList" style="width:350px;padding:5px">No folders found in the directory.</li>';
}
echo '</div>';
	
exit();	
}
/// if just looking for files

echo '<script>

function swapDir(dirID, start) {
	$.ajax({
   type: "GET",
   url: "searchBox.cc?n=3&q=1&id=" + dirID,
   success: function(msg){
   	if (start == 1) {
   		msg = \'<div style="padding:5px; font-size:14px; border-bottom:1px solid #999;">Please select a folder below to save your content to. Double click on a folder to view its subfolders.</div>\' + msg;
   	}
     $("#contents").html(msg);
   }
 });
}

	$(function() {
		swapDir(0, 1);
	});
	
	
function disableSelection(target){
if (typeof target.onselectstart!="undefined") //IE route
	target.onselectstart=function(){return false}
else if (typeof target.style.MozUserSelect!="undefined") //Firefox route
	target.style.MozUserSelect="none"
else //All other route (ie: Opera)
	target.onmousedown=function(){return false}
target.style.cursor = "default"
}


disableSelection(document.getElementById("contents"));

function addsearchCon() {
	dataString = $("#add-content").serialize();
	 $.ajax({
        type: "POST",
        url: "searchBox.cc?n=3",
        data: dataString,
        success: function(data) {
        		if (data == 1) {
        			$("#mainCon").html(\'<div class="successbox" style="text-align:center; font-weight:bolder">Content Saved Successfully!</div>\');
        			setTimeout(function() closeBox(), 500);
        		} else {
               $("#failer").html(data);
            }

        }

        });
	
}


	</script>';

echo '<div class="headTitle"><img src="' . $imgServer . 'gen/save_l.png" style="margin-top:4px; margin-right: 5px" /><div>Save Content</div></div>
<div id="mainCon">
<form method="GET" id="add-content" style="font-size:14px">

<div id="failer" style="margin-top:5px; margin-left:3px; margin-right:3px"></div>

<div style="margin-left:5px; margin-top:5px">
<strong>File Name</strong> <span style="color:#dd1100;font-style: bolder">*</span><br />
<input type="text" name="name" style="width:335px" maxlength="45" value="' . $_GET['title'] . '" /><br /><br />

<textarea name="code" style="display:none">' . $_GET['code'] . '</textarea>

<input type="hidden" name="type" value="' . $_GET['type'] . '" />

<strong>Description</strong><br />
<textarea name="body" style="height:50px; width:335px">' . $_GET['desc'] . '</textarea>

</div>
<div style="margin-top:10px; font-weight:bolder; border-bottom:2px solid #999">&nbsp;&nbsp;Choose Folder</div>
<div id="contents">



</div>

</form>
<div id="bottom" style="margin-top:10px; margin-bottom:5px; float:right">
<button class="button" onClick="addsearchCon();" type="submit"> 
<img src="' . $imgServer . 'gen/tick.png" /> Save Content
</button>
<button class="button" onClick="closeBox();" type="submit"> 
<img src="' . $imgServer . 'gen/cross.png" /> Close
</button>
</div>

</div>';	
} // auth Dir




?>