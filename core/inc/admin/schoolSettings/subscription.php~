<?php
$sid = $school['id'];
if (isset($_GET['n']) && is_numeric($_GET['n'])) {

if ($_GET['n'] == 1) {
	$errors = array();

	if ($_POST['vanity'] != '') {
		$vanity = escape($_POST['vanity']);
		
		if ($vanity == $school['settingDomain'] && $vanity != '') {
		$errors[] = 'You already own this vanity URL.';
		} else {
			if (ctype_alnum($vanity) == false) {
				$errors[] = 'URL can only contain alphanumeric characters. (A-Z & 0-9)';
			} else {
				// check if this domain is taken
				$testURL = good_query_assoc("SELECT * FROM schools WHERE settingDomain = '$vanity' LIMIT 1");
				if ($testURL != false) {
					$errors[] = 'This vanity URL has already been taken.';
				}
			}
		}
		
	} else {
		$errors[] = 'You forgot to enter your desired vanity URL.';
	}
	
	

	if (empty($errors)) {
		$update = good_query("UPDATE schools SET settingDomain = '$vanity' WHERE id = $sid LIMIT 1");
		echo "1";
	} else {
		echo '<div class="errorbox" ><span style="font-size:14px; font-weight:bolder">Oops!</span>';
			foreach ($errors as $error) {
				echo '<li>' . $error . '</li>';
			}
		echo '</div>';
	
	}
	
	
	
} // if n
exit();
} // if n numeric
?>
<script type="text/javascript">
// function for submitting the school signup form
function updateVanity() {
        dataString = $("#enrollTrial").serialize();

        $.ajax({
        type: "POST",
        url: "school-admin.cc?id=<?php echo $school['id']; ?>&s=7&n=1",
        data: dataString,
        success: function(data) {
        	if (data == 1) {
               $("#failer").html('<div class="successbox" style="text-align:center; font-weight:bolder">Your Trial Request Has Been Sent!</div>').slideDown(400).delay(2500).slideUp(400);
         } else {
         	 $("#failer").html(data).slideDown(400);
         	 
         }
               
       }

        });
}
</script>

<div id="navcrumbs"><?php echo $school['name']; ?> <img src="<?php echo $imgServer; ?>main/l_arrow.png" /> <strong>Subscription</strong></div>
<?php
if($school['subscription'] == 0) {
	$class="errorbox";
	$body='<p style="font-size:14px">Having a ClassConnect subscription allows you to do more with our platform. You can manage administrator accounts, lock into a basic service level agreement (SLA) with us, and much much more! To request a free trial of ClassConnect\'s premium subscription, click here.</p>';
} else {
	$class="infobox";
	$body='<p style="font-size:14px">Your ClassConnect Ambassador<br />
	<span style="font-size:16px; font-weight:bolder">Eric Simons</span><br /><br />
	Email Address<br />
	<span style="font-size:16px; font-weight:bolder">ericsimons@classconnect.com</span><br /><br />
	Direct Phone Number<br />
	<span style="font-size:16px; font-weight:bolder">630-815-5680</span><br /><br />
	
	</p>';
}
?>
<div class="<?php echo $class; ?>" style="font-size:18px;text-align:center">You have <strong><?php echo $school['subscription'];?> days</strong> remaining in your subscription.</div>
<?php echo $body; ?>
	
	
	<form id="updater" method="POST"><div style="display:none"><input type="password" name="pass" /></div></form>
	
<div id="failer" style="display:none"></div>