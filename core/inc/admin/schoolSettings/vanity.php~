<?php
$sid = $school['id'];
if (isset($_GET['n']) && is_numeric($_GET['n'])) {

if ($_GET['n'] == 1) {
	$errors = array();

	if ($_POST['vanity'] != '') {
		$vanity = escape($_POST['vanity']);
		
		if ($vanity == $school['settingDomain'] && $vanity != '') {
		$errors[] = 'You already own this vanity URL.';
		} else {
			if (ctype_alnum($vanity) == false) {
				$errors[] = 'URL can only contain alphanumeric characters. (A-Z & 0-9)';
			} else {
				// check if this domain is taken
				$testURL = good_query_assoc("SELECT * FROM schools WHERE settingDomain = '$vanity' LIMIT 1");
				if ($testURL != false) {
					$errors[] = 'This vanity URL has already been taken.';
				}
			}
		}
		
	} else {
		$errors[] = 'You forgot to enter your desired vanity URL.';
	}
	
	

	if (empty($errors)) {
		$update = good_query("UPDATE schools SET settingDomain = '$vanity' WHERE id = $sid LIMIT 1");
		echo "1";
	} else {
		echo '<div class="errorbox" ><span style="font-size:14px; font-weight:bolder">Oops!</span>';
			foreach ($errors as $error) {
				echo '<li>' . $error . '</li>';
			}
		echo '</div>';
	
	}
	
	
	
} // if n
exit();
} // if n numeric
?>
<script type="text/javascript">
// function for submitting the school signup form
function updateVanity() {
        dataString = $("#updater").serialize();

        $.ajax({
        type: "POST",
        url: "school-admin.cc?id=<?php echo $school['id']; ?>&s=6&n=1",
        data: dataString,
        success: function(data) {
        	if (data == 1) {
               $("#failer").html('<div class="successbox" style="text-align:center; font-weight:bolder">Vanity URL Updated Successfully!</div>').slideDown(400).delay(2500).slideUp(400);
         } else {
         	 $("#failer").html(data).slideDown(400);
         	 
         }
               
       }

        });
}
</script>

<div id="navcrumbs"><?php echo $school['name']; ?> <img src="<?php echo $imgServer; ?>main/l_arrow.png" /> <strong>School Vanity URL</strong></div>
	
	<form id="updater" method="POST"><a href="#" onClick="updateVanity()" class="button" style="float:right"><img src="<?php echo $imgServer; ?>gen/tick.png" />Update Vanity URL</a><div class="infobox" style="font-size:18px">http://<input type="text" name="vanity" maxlength="40" value="<?php echo $school['settingDomain']; ?>" style="font-size:18px;width:250px; border-top:none;border-left:none;border-right:none;text-align:center;font-weight:bolder" />.classconnect.com</div><div style="display:none"><input type="password" name="pass" /></div></form>
	
<div id="failer" style="display:none"></div>