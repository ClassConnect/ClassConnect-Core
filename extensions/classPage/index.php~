<?php
// include core stuff
require_once('../../core/inc/coreInc.php');
// app extension file
require_once('../core/main.php');
// local extension file
require_once('core/main.php');

echo '<cc:crumbs>{className}</cc:crumbs>';
?>

<script type="text/javascript">
var commenterCount = 0;

function classActions() {

$("#message_wall").focus(function()
{
if ($(this).val() == " post a comment..." || $(this).val() == " post an update...") {
$(this).val("");
$(this).removeAttr("style");
}
});

}



function loadComments() {
	$("#loadMore").html('<center><img src=\"core/site_img/loading.gif\" /></center>');
	var hitURL = postToAPI("POST", "action.php?n=3", "1", <?php echo $class_id; ?>, 'start=' + commenterCount);
	$.ajax({
   	type: "GET",
   	url: hitURL,
   	success: function(data) {
   		$("#loadMore").remove();
   		$("#class_comments").html($("#class_comments").html()+data);
      }
										
   });
	commenterCount++;
}



function deleteComment(comment_id) {
	var hitURL = postToAPI("POST", "action.php?n=2", "1", <?php echo $class_id; ?>, 'commentID=' + comment_id);
	$.ajax({
   	type: "GET",
   	url: hitURL,
   	success: function(data) {
   		$("#comment" + comment_id).fadeOut(200);
   		$("#bottom" + comment_id).fadeOut(200);
      }
										
   });
   
}

$(document).ready(function(){  
 classActions();
 loadComments();
 })  

</script>


<?php
// include student header
if ($class_level == 1) {
	$comment_swap = 'a comment';
	$class = 'commentbox';
	$class2 = 'commentfooter';

// include teacher header
} elseif ($class_level == 3) {
	require_once('templating/page/teacher.php');
	$comment_swap = 'an update';
	$class = 'darkcommentfooter';
	$class2 = 'darkcommentfooter';
	
}


$update = getUpdate($class_id);

if ($update != false) {
	$latest = '<span style="font-size:16px">' . $update['body'] . '</span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-style: italic; color:#999">- Posted at ' . date('g:i A', strtotime($update['date_posted'])) . ' on ' . date('F j, Y', strtotime($update['date_posted'])) . '</span>';
} else {
	$latest = '<span style="font-size:16px">No updates found for this class.</span>';
}

echo '<div class="' . $class . '">
<div id="latestUpdate" style="margin-bottom:10px; padding-bottom:10px; border-bottom:1px solid #ccc">' . $latest . '</div>
<form method="POST" action="action.php?n=1" id="submit_wall">
<input type="text" name="message" id="message_wall" style="color:#999;font-style:italic" class="commentwall" value=" post ' . $comment_swap . '..." />
<input type="submit" name="submit" value="submit" class="comment" />
</form>
</div>
<div class="' . $class2 . '">&nbsp;</div>

<div id="class_comments"><div id="loadMore"><center><img src="core/site_img/loading.gif" /></center></div>';






?>