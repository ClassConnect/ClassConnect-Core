<?php 
// include core stuff
require_once('../../core/inc/coreInc.php');
// app extension file
require_once('../core/main.php');
// local extension file
require_once('core/main.php');



// if class comment
if ($_GET['n'] == 1) {
	
	
if (isset($_POST['message'])) {
	$message = escape($_POST['message']);
	addComment($message, $user_id, $class_level, $class_id);
} 
?>

<cc:inline>
<?php if ($message != '') { 
if ($class_level == 3) {
		$cssClass = 'darkcommentbox';
		$cssClass2 = 'darkcommentfooter';

		$classData = getClass($class_id);
		// send notification
		sendClassNotification($class_id, $classData['name'] . ' has just posted a <a href="class.cc?id=' . $class_id . '">new update.</a>');
		
		$append = '$(\'#latestUpdate\').hide(); $(\'#latestUpdate\').html(\'<span style="font-size:16px">' . $message . '</span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-style: italic; color:#999">- Posted at ' . date('g:i A') . ' on ' . date('F j, Y') . '</span>\').fadeIn(400);';
		
	} else {
		$cssClass = 'commentbox';
		$cssClass2 = 'commentfooter';
	}
	
$me = getUser($user_id);
?>
<script type="text/javascript">

$(document).ready(function(){  

var message_wall = $('#message_wall').attr('value');
$("#class_comments").prepend("<div class=\"<?php echo $cssClass; ?>\" style=\"display:none\"><img src=\"http://localhost/cc4/app/core/site_img/client_img/user/32703.png\" height=\"40\" width=\"40\" style=\"float:left;border:2px solid #e1e1e1;margin-right:5px;\" /><a href=\"#\"><strong><?php echo $me['first_name'] . ' ' . $me['last_name']; ?></strong></a> - <?php echo $message; ?></div><div class=\"<?php echo $cssClass2; ?>\" style=\"display:none\"><?php echo 'Posted at ' . date('g:i A') . ' on ' . date('F j, Y'); ?></div>");
$("#class_comments .<?php echo $cssClass; ?>:first").slideDown();
$("#class_comments .<?php echo $cssClass2; ?>:first").fadeIn();

$('#message_wall').val('');

$('#noComments').remove();

<?php echo $append; ?>

});
</script>

<?php } ?>
</cc:inline>


<?php 
// de;ete comment
} elseif ($_GET['n'] == 2) { 
if ($class_level == 3) {
if (isset($_POST['commentID'])) {
	$commentID = escape($_POST['commentID']);
	removeComment($commentID, $class_id);
	echo '1';
} 
}


// load comments
} elseif ($_GET['n'] == 3) { 

$start = escape($_POST['start']) * 20;

$comments = getComments($class_id, $start, 20);

foreach ($comments as $comment) {
	if ($comment['level'] == 3) {
		$cssClass = 'darkcommentbox';
		$cssClass2 = 'darkcommentfooter';
	} else {
		$cssClass = 'commentbox';
		$cssClass2 = 'commentfooter';
	}
	echo '<div id="comment' . $comment['comment_id'] . '" class="' . $cssClass . '">
<img src="http://localhost/cc4/app/core/site_img/client_img/user/32703.png" height="40" width="40" style="float:left;border:2px solid #e1e1e1;margin-right:5px;" /><a href="#"><strong>' . $comment['first_name'] . ' ' . $comment['last_name'] . '</strong></a> - ' . $comment['body'] . '
</div>
<div id="bottom' . $comment['comment_id'] . '" class="' . $cssClass2 . '">Posted at ' . date('g:i A', strtotime($comment['date_posted'])) . ' on ' . date('F j, Y', strtotime($comment['date_posted']));

// show delete if teacher
if ($class_level == 3) {
	echo '<span style="float:right; font-weight:bolder"><a href="#" class="delMe" target="_blank" onClick="deleteComment(' . $comment['comment_id'] . '); 	return false;">Delete</a></span>';
}

echo '</div>';

}

// if no comments are found
if (empty($comments)) {
	echo '<div id="noComments" class="commentbox" style="text-align:center; font-weight:bolder">We were unable to find any comments for this class.</div>';
	
} else {
	
	
	// display more button
	echo '<a id="loadMore" href="#" target="_blank" onClick="loadComments(); return false;"><div class="comment_load" style="clear:both">
   <div class="comment_load_text">View More Comments</div>
    </div></a>';
	
}












}// get n ?>